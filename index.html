<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dynamic Greeting</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 10%; }
    h1 { font-size: 2.5rem; }
    .loader { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1 id="greeting">Hello</h1>
  <div class="loader" id="loader"></div>
  <script>
    function getQueryParam(key) {
      return new URLSearchParams(window.location.search).get(key);
    }

    function getGreeting(hour) {
      if (hour >= 5 && hour < 12)    return "Good Morning";
      if (hour >= 12 && hour < 18)   return "Good Afternoon";
      if (hour >= 18 && hour < 22)   return "Good Evening";
      return "Hello";
    }

    // Typewriter effect for the name: gradually show the letters
    async function typeWriter(element, text, speed = 100) {
      element.textContent = "";
      for (let i = 0; i < text.length; i++) {
        element.textContent += text.charAt(i);
        await new Promise(resolve => setTimeout(resolve, speed));
      }
    }

    document.addEventListener("DOMContentLoaded", async function () {
      const name = getQueryParam("name");

      if (!name) {
        document.getElementById("greeting").textContent = "Hello";
        return;
      }

      document.getElementById("greeting").textContent = `Hi, one moment...`;
      document.getElementById("loader").textContent = "Detecting your local time...";

      try {
        const res = await fetch("https://ipapi.co/json/");
        const data = await res.json();
        const now = new Date(new Date().toLocaleString("en-US", { timeZone: data.timezone }));
        const greeting = getGreeting(now.getHours());

        document.getElementById("loader").textContent = "";

        // Split greeting and typewriter for name
        // e.g. "Good Afternoon " — static, name — typewriter, "," — static
        const greetingElement = document.getElementById("greeting");
        greetingElement.textContent = greeting + " ";

        // Create a span to hold the typed name
        const nameSpan = document.createElement("span");
        greetingElement.appendChild(nameSpan);

        await typeWriter(nameSpan, name, 120); // 120ms speed per char, adjust as needed

        // Append the comma after typing finishes
        greetingElement.appendChild(document.createTextNode(","));

      } catch (e) {
        // Fallback: no typing effect if error
        document.getElementById("loader").textContent = "(Could not detect your local time.)";
        document.getElementById("greeting").textContent = `Hello ${name},`;
      }
    });
  </script>
</body>
</html>
